from abc import ABC, abstractmethod
from dataclasses import dataclass
from typing import Any

from openai.types.responses import FunctionToolParam
from pydantic import BaseModel

from nanoeval.solvers.computer_tasks.code_execution_interface import ComputerInterface


class Tool(BaseModel, ABC):
    """
    Abstract base class for BasicAgent tools.
    Custom tools used by BasicAgent should implement this interface.

    - `name` is used to identify the tool
    - `execute` is called to run the tool, typically to run commands on the
      computer
    - `get_oai_tool_call` returns the OpenAI function tool schema defining this tool's usage
    """

    @abstractmethod
    def name(self) -> str:
        """
        Returns the unique name of this tool.
        """
        ...

    @abstractmethod
    async def execute(self, computer: ComputerInterface, *args: Any, **kwargs: Any) -> str:
        """
        Executes the tool with the given arguments and returns output.
        """
        ...

    @abstractmethod
    def get_oai_tool_call(self) -> FunctionToolParam:
        """
        Returns the OpenAI Responses function tool schema for this tool.
        """
        ...


@dataclass
class ToolCall:
    name: str
    """The name of the function to run."""

    arguments: dict[Any, Any]
    """A JSON string of the arguments to pass to the function."""

    call_id: str
    """The unique ID of the function tool call generated by the model."""
